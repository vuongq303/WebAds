var url = "http://localhost:8000/";
try {
  let { data: t } = await axios.get(url + "user/getUser");
  createTableUser(t);
} catch (t) {
  console.log(t);
}
try {
  let { data: t } = await axios.get(url + "request/getRequest");
  createTableRequest(t);
} catch (t) {
  console.log(t);
}
function createTableUser(t) {
  const d = document.getElementById("user");
  t.forEach((e) => {
    const t = document.createElement("tr");
    const n = document.createElement("td");
    const a = document.createElement("td");
    const o = document.createElement("td");
    const c = document.createElement("td");
    const i = document.createElement("td");
    const l = document.createElement("td");
    const r = document.createElement("button");
    const s = document.createElement("button");
    n.textContent = e.id;
    a.textContent = e.tai_khoan;
    o.textContent = e.mat_khau;
    c.textContent = e.so_tien;
    i.textContent = e.trang_thai == 1 ? "Đang sử dụng" : "Bị khóa";
    l.append(r, s);
    r.textContent = "Mở khóa";
    s.textContent = "Tạm đóng";
    e.trang_thai == 1 ? (r.disabled = true) : (s.disabled = true);
    r.classList.add("btn", "btn-success");
    s.classList.add("btn", "btn-primary");
    s.style.marginLeft = "5px";
    s.onclick = async function () {
      let t = window.confirm("Xác nhận đóng tài khoản");
      if (t) {
        try {
          let { data: t } = await axios.put(url + "user/dongTaiKhoan", {
            tai_khoan: e.tai_khoan,
          });
          if (t.success) {
            alert(t.message);
          } else {
            throw new Error(t.error);
          }
          location.reload();
        } catch (t) {
          alert(t.response.data.error);
        }
      }
    };
    r.onclick = async function () {
      let t = window.confirm("Xác nhận mở tài khoản");
      if (t) {
        try {
          let { data: t } = await axios.put(url + "user/moTaiKhoan", {
            tai_khoan: e.tai_khoan,
          });
          if (t.success) {
            alert(t.message);
          } else {
            throw new Error(t.error);
          }
          location.reload();
        } catch (t) {
          alert(t.response.data.error);
        }
      }
    };
    t.append(n, a, o, c, i, l);
    d.appendChild(t);
  });
}
function createTableRequest(t) {
  const u = document.getElementById("request");
  t.forEach((e) => {
    const t = document.createElement("tr");
    const n = document.createElement("td");
    const a = document.createElement("td");
    const o = document.createElement("td");
    const c = document.createElement("td");
    const i = document.createElement("td");
    const l = document.createElement("td");
    const r = document.createElement("td");
    const s = document.createElement("button");
    const d = document.createElement("button");
    n.textContent = e.id;
    a.textContent = e.tai_khoan;
    o.textContent = e.so_tien;
    c.textContent = e.thong_tin1;
    i.textContent = e.thong_tin2;
    if (e.trang_thai == 0) l.textContent = "Đã xác nhận";
    if (e.trang_thai == 1) l.textContent = "Chưa xác nhận";
    if (e.trang_thai == -1) l.textContent = "Đã từ chối";
    r.append(s, d);
    s.textContent = "Xác nhận";
    d.textContent = "Từ chối";
    s.classList.add("btn", "btn-success");
    d.classList.add("btn", "btn-primary");
    d.style.marginLeft = "5px";
    if (e.trang_thai == 0) {
      s.disabled = true;
      d.disabled = true;
    }
    if (e.trang_thai == -1) d.disabled = true;
    s.onclick = async function () {
      let t = window.confirm("Xác nhận yêu cầu");
      if (t) {
        try {
          let { data: t } = await axios.put(url + "request/xacNhanYeuCau", {
            id: e.id,
          });
          if (t.success) {
            alert(t.message);
          } else {
            throw new Error(t.error);
          }
          location.reload();
        } catch (t) {
          alert(t.response.data.error);
        }
      }
    };
    d.onclick = async function () {
      let t = window.confirm("Từ chối yêu cầu");
      if (t) {
        try {
          let { data: t } = await axios.put(url + "request/tuChoiYeuCau", {
            id: e.id,
          });
          if (t.success) {
            alert(t.message);
          } else {
            throw new Error(t.error);
          }
          location.reload();
        } catch (t) {
          alert(t.response.data.error);
        }
      }
      t;
    };
    t.append(n, a, o, c, i, l, r);
    u.appendChild(t);
  });
}
